# Event message service
Сервис осуществляет управление данными о рассылках/клиентах, а также организует отправку сообщений клиентам в соответствии с хранимыми рассылками. Сервис полностью устойчив к недоступности внешнего сервиса отправки сообщений клиентам и может откладывать частично или полностью задачи по отправке сообщений клиентам. Вся статистика отправленных сообщений хранится в базе данных и ее в любой момент можно получить из API сервиса.

---

## Установка

### Репозиторий

1. Клонируйте репозиторий в любую подходящую директорию:

```
git clone https://gitlab.com/fluxx1on_group/event_message_service.git
```

2. Убедитесь что у вас установлен Golang версии старше 1.19. Также для запуска может потребоваться Redis. Если не установлен смотреть сноску внизу страницы.

3. Запустите настройку окружения и установку зависимостей через Makefile в корневой папке проекта (рекомендуется выполнять создание бд и миграции вручную):

```
make setup
```

4. Осталось только запустить сервер:

```
make run
```

### Docker containers

1. Клонируйте репозиторий в любую подходящую директорию:

```
git clone https://gitlab.com/fluxx1on_group/event_message_service.git
```

2. Запустите образы собранные в docker compose выполнив команду в корневой директории проекта:

```
make docker-up
```

---

## Общие сведения

### Стек

- Язык программирования - Go ;
- API - REST; 
- Логгирование в несколько этапов:
    - Основные логи по StatusCode API сервиса - gin.Logger;
    - Логи общего назначения собирающие всю информацию о слоях бизнес логики и слое работы с сущностями - slog;
    - Включено журналирование для slog (планировалось перевести эти логи в спец. бд для быстрого поиска по логам);
- База данных - PostgreSQL. Репозитории для каждой сущности с соответствующими интерфейсами;
- Брокер сообщений - NATS. Отвечает за персистентность данных и передачу их менеджеру задач. Тот в свою очередь следит за отправкой соообщений пользователям в отведенный промежуток времени. Взаимодействие через роутер - горизонтальное масштабирование в NATS не сильно усложнит дальнейшую разработку;
- Спецификация - swagger. Доступна по адресу /docs.
- Метрики Prometheus. Доступны по адресу /metrics. Дополнительные эндпоинты связаны с основными ручками API и отслеживают возвращаемые коды.